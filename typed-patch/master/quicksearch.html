<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Modules Classes Arr ElementFactory Ins Map Mrg Op Row Rpl Options Patch × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Classes Classes Arr ElementFactory Ins Map Mrg Op Row Rpl Options Patch × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Typed PatchThe type-aware object patch utility. Tl;DRlet patch = Patch.compare(object1, object2); let object3 = patch.apply(object2)and object3 should equal object1. If any of the properties and sub-properties of object1 are themselves classes, and have a static method fromJSON somewhere in their prototype chain, then this fromJSON method will be applied to the result of merging properties betweem the appropriate sub-trees in order to create an object of the correct class. Arrays are merged with an LCS diff algorithm, preserving sort order. ES6 Map objects are merged using an ordered join which may result in a different order of elements in the resulting maps (the result will always be sorted by key). The utility has more subtle and feature-rich ways of specifying types, and doing things like deciding the type of array elements and specifying how arrays are merged. If interested, read on. For the latest API documentation see The Software Plumbers Site Project StatusAlpha. It seems functional, and the unit tests pass. The basic API is settling down. Why another diff/patch utility?This one is aware of object types and potential polymorphism in the patch. That is to say, that the object tree that results from applying a patch to an object may contain objects of different classes to those which were in the patch object or indeed to those in the original patched object. Many other diff/patch utilities also create rather verbose patches; the JSON pointer specification (RFC6901) is admirable but its use as a basis for a patch format is questionable. If each leaf that differs in the tree must be identified by its full path from the root (per JSONP) then in deeply nested object trees the property names nearer the root appear many times in the resulting diff. This diff creates a hierarchical diff format that is concise and reasonably easy to read. Type AwarenessWhen merging properties between the patched object and the patch, the resulting property can either be a straight object (in which case, no problem) or an instance of a class. To create an instance of the class, the patch algorithm needs to know what kind of object to create. Encoding types in the diff format is an option which we have rejected due to the implications of allowing data transmitted over the wire to specify a class name that the data will be converted into. This problem is closely related to the issue of re-creating object trees from JSON delivered across the wire or from document stores like Mongo. This may be why there are so many diff utilities - they are usually bound to a particular way of doing things. By default, typed-patch therefore derives type information entirely from the object to be patched. This can be achieved most simply by putting a static method fromJSON in the base class of any typed property. This method is used to covert untyped properties into an instance of the required object class. This works in many cases, but not when the patch contains properties that do not exist in the patched object. In this case, we need to implement a getAttrProps static method which takes a name argument and returns an object containing a factory method (elementFactory) or an object type elementType suitable for populating the property of that name. Array and Map propertiesIn the case of array and map properties, getAttrProps may also return the following metadata: collectionElementType the type of elements in the array collectionElementFactory a factor object for creating new array elements sorted defines if a map can be assumed to be sorted by its key (avoiding a re-sort) map determines if an array can be treated as a map. If so, the additional properties below are needed key a function that can extract a unique ID from the array element (e.g. e=&gt;e.id) value a function that can extract a value from the array element (e.g. to e=&gt;e) entry a function that can construct a array element from a key/value pair (e.g. (k,v)=&gt;v) keyComparator a comparator object for comparing keys, required if key values cannot be compared with &gt;,&lt;,=== Maps are diffed and merged by comparing a sorted lists of key values; the order of maps may not be preserved in the merge operation. Arrays are diffed using an LCS algorithm, unless the 'map' option is true in which case they are diffed as Maps using the values extracted by the key and value functions. × Search results Close "},"module-operations.html":{"id":"module-operations.html","title":"Module: operations","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Module: operations Classes Arr ElementFactory Ins Map Mrg Op Row Rpl Members &lt;inner, constant&gt; DEL Global Del object - represents a patch that deletes a property &lt;inner, constant&gt; NOP Global Nop object - represents an empty patch that does nothing Methods patch() patch operation Returns: undefined patch(object) patch operation passes through object unchanged Parameters: Name Type Description object to patch × Search results Close "},"module-operations-Arr.html":{"id":"module-operations-Arr.html","title":"Class: Arr","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Arr operations~ Arr Merge operation for arrays. new Arr(operations) Create an array merge operation Parameters: Name Type Description operations Array An array of row merge operations, must be sorted by a suitable key Methods patch(array, options) Merge array data with data from the patch. Parameters: Name Type Description array Array to merge with patch data. options options affecting how merge is performed. See DEFAULT_OPTIONS toJSON() Convert to JSON representation. The JSON representation of an Map operation looks like { op: 'Map' data: [ &lt;rows&gt; ] } toString() Convert to String representation. The String representation of an Map operation looks like Map [ &lt;rows&gt; ] × Search results Close "},"module-operations-ElementFactory.html":{"id":"module-operations-ElementFactory.html","title":"Class: ElementFactory","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: ElementFactory operations~ ElementFactory Utility for creating patched data elements, controlled by options object. new ElementFactory() Methods &lt;static&gt; createElement(props, options, type_hint) Create an merged object of the correct type. If options.elementFactory exists, use that (i.e. call options.elementFactory(props)) If options.elementType exists, use that as a no-arg constructor, then assign props Otherwise, return props. Parameters: Name Type Description props Merged properties options Options controls how new merged object is created from merged properties type_hint for when result type info needs to be inferred from input objects (i.e. a dirty hack) × Search results Close "},"module-operations-Ins.html":{"id":"module-operations-Ins.html","title":"Class: Ins","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Ins operations~ Ins Insert operation - represents a patch that inserts an element into an array new Ins() Methods toJSON() Convert to JSON representation. The JSON representation of an Insert operation looks like { op: 'Ins' data: '&lt;data&gt;' } toString() Convert to String representation The String representation of a Replace operation looks like inserts ` × Search results Close "},"module-operations-Map.html":{"id":"module-operations-Map.html","title":"Class: Map","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Map operations~ Map Merge operation for Maps (Map == iterable with a unique key) new Map(operations) Create an array merge operation Parameters: Name Type Description operations Array An array of row merge operations, must be sorted by a suitable key Methods patch(map, options) Merge map data with data from the patch. Parameters: Name Type Description map to merge with patch data. options options affecting how merge is performed. See DEFAULT_OPTIONS toJSON() Convert to JSON representation. The JSON representation of an Map operation looks like { op: 'Map' data: [ &lt;rows&gt; ] } toString() Convert to String representation. The String representation of an Map operation looks like Map [ &lt;rows&gt; ] × Search results Close "},"module-operations-Mrg.html":{"id":"module-operations-Mrg.html","title":"Class: Mrg","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Mrg operations~ Mrg Merge operation for objects - represents a patch that merges two objects to create a third. new Mrg(data) Constructor Parameters: Name Type Description data to merge with target object. Each property of data will generally be a patch operation which affects the named property of the object targeted by patch(). Methods patch(object, options) Recursively merge an object with the patch data. Properties of the data object passed into the constructor will be merged with the properties of the object supplied as an argument to this function. Parameters: Name Type Description object Object to be merged options Options controlling how merge will occur. See DEFAULT_OPTIONS. × Search results Close "},"module-operations-Op.html":{"id":"module-operations-Op.html","title":"Class: Op","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Op operations~ Op Base class for patch operations. Patch operations should support the following operations: patch(to_patch, options) recursively apply patch to change to_patch toJSON() convert a patch into JSON for over-the-wire operations toString() convert a patch into a succincy human-readable string format Patch operations should also have a read-only property 'name' which represents the name of the operation. new Op() Members name Defauly implementation of name property returns the name of the constructor Methods toJSON() Convert to JSON format JSON format looks like { op: &lt;operation name&gt; data: &lt;data&gt; }. As a special case, Rpl operations (which simply replace existing data) are elided in JSON format (so the above example would just read &lt;data&gt;). The patch operation as an untyped JSON object tree. toString() Convert to String format String format looks like &lt;operation name&gt; { &lt;data&gt; } × Search results Close "},"module-operations-Row.html":{"id":"module-operations-Row.html","title":"Class: Row","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Row operations~ Row Represents an patch operation on an array row. new Row() × Search results Close "},"module-operations-Rpl.html":{"id":"module-operations-Rpl.html","title":"Class: Rpl","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Rpl operations~ Rpl Replace operation - represents a patch that replaces a property or row in an array new Rpl(data) Constructor Parameters: Name Type Description data Data to replace property value Methods patch(properties, options) Patch operation - creates a new object from the givien properties. Parameters: Name Type Description properties of object to create options controls how object is created DEFAULT_OPTIONS toJSON() Convert to JSON representation. The JSON representation of a Replace operation is the JSON representation of the data value passed in the constructor. toString() Convert to String representation The String representation of a Replace operation looks like Rpl &lt;data&gt; × Search results Close "},"module-options.html":{"id":"module-options.html","title":"Module: options","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Module: options Classes Options Members &lt;inner, constant&gt; DEFAULT_OPTIONS Default options for diff Option Default Description elementFactory false Factory used to create new object instances mergeInPlace false Patch will copy properties into existing object rather than creating a new one key e=&gt;e[0] Function to extract key from a map entry value e=&gt;e[1] Function that extracts value from map entry entry (k,v)=&gt;[k,v] Create a map entry keyComparator false Comparator function (a,b) =&gt; (-1/0/1) that orders key values sorted false Assume array already sorted by key arrayElement false Type of element used as a last resort to create new object instances collectionElementType false Type of element used to create new elements in an array collectionElementFactory false Factory used to create new elements in an array × Search results Close "},"module-options-Options.html":{"id":"module-options-Options.html","title":"Class: Options","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Options options~ Options Holds options which change the way compare and patch operations are run. An options object can be passed in to a compare or patch opertion in order to control how the operation is performed. However, it is more common to simply pass in a few paramters as a simple object which will then be automatically merged with the default options to create a new Options object. new Options(props) Build a new options object Parameters: Name Type Description props Properties for diff/patch operations. Will be merged with default options. Methods &lt;static&gt; addDefaults(properties) Create a new Options object, merging the supplied properties with the defaults. Parameters: Name Type Description properties to merge with defaults. getArrayElementOptions() Get a new set of options for diff/patch operations on an array element. getChildOptions(object, name) Get a new set of options for diff/patch operations on the given property. Parameters: Name Type Description object being patched or diffed. name name of propery in object × Search results Close "},"module-patch.html":{"id":"module-patch.html","title":"Module: patch","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Module: patch Classes Patch × Search results Close "},"module-patch-Patch.html":{"id":"module-patch-Patch.html","title":"Class: Patch","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Class: Patch patch~ Patch Patch for objects Class that should allow us to compare two objects, compute a difference, send the difference over the wire, and apply a patch at the far end to sync a remote object with the changes. At the moment, for it to work with arrays, each member of the array must have a key property which uniquely identifies it and on which it can be sorted (arrays must have a stable sort order to be logically patched...). For 'patch' to work properly, the patched object (and child objects) should have a static 'fromJSON' method somewhere in its inheritance tree. You may also implement a static 'getAttrProps(name)' object, which may return a variety of options that are applied to child properties with the given name (see DEFAULT_OPTIONS). Won't work with cyclic data structures. new Patch() Members &lt;static&gt; Del Name of Del operationn &lt;static&gt; Ins Name of Ins operationn &lt;static&gt; Map Name of Map operation &lt;static&gt; Mrg Name of Mrg operation &lt;static&gt; Nop Name of Nop operationn &lt;static&gt; Rpl Name of Rpl operationn Methods &lt;static&gt; compare(a, b, options) Compare two object to produce a patch object. Parameters: Name Type Description a First object for comparison b Second object for comparison options (optional) options to control comparison operation (see DEFAULT_OPTIONS) &lt;static&gt; fromJSON() Convert over-the-wire JSON format back into typed patch object × Search results Close "},"module-utils.html":{"id":"module-utils.html","title":"Module: utils","body":" typed-patch Modules operationsoptionspatchutils Classes operations~Arroperations~ElementFactoryoperations~Insoperations~Mapoperations~Mrgoperations~Opoperations~Rowoperations~Rploptions~Optionspatch~Patch Module: utils Utility functions for typed-patch Methods &lt;inner&gt; appendString(res, name) Append a name/value pair to a string. Appends name : value to a string, prefixed with a ',' if the string is not empty. Parameters: Name Type Description res string to append to name name to append param value value to append &lt;inner&gt; compare(a, b) Utility function to objects that have a key properties options.key holds the name of the key property options.keyComparator may hold an optional comparator for values of key Parameters: Name Type Description a object with a key value b object with a key value &lt;inner&gt; compareWith(akey, b) Utility function to compare key with object (that has a key property) options.key holds the name of the key property options.keyComparator may hold an optional comparator for values of key Parameters: Name Type Description akey key to compare with object b object with a key value &lt;inner&gt; map(object, fn) Utility function that applies a function to transform all the properties of an object Parameters: Name Type Description object for which we will transform properties fn function function to apply property transformation &lt;inner&gt; print(object) Convert object to string recursively with all properties. Parameters: Name Type Description object to convert to string Returns: a standard string representation. &lt;inner&gt; reduce(object, res, fn) Utility function that performs reduce operation on properties of an object Parameters: Name Type Description object to reduce res initial value for result fn reduction function Returns: the result of applying res = fn(res, , ) over all properties of the object. × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
